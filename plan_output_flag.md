## 出力フラグ刷新計画

### 目的
- `stdout` 以外への出力を CLI 共通の設計に揃え、Agents 系モードでも一貫して利用できるようにする。
- 既存の `--d2-file` / `--mermaid-file` などモード固有フラグを廃し、結果コピー/保存を単一フラグで制御する。

### フラグ仕様
- `--output, -o <path>`
  - 結果を指定ファイルへ UTF-8 で書き出す。
  - ディレクトリが指定された場合は即時エラー。
  - 拡張子の制約は設けず、利用者に委ねる。
- `--copy`
  - macOS の `pbcopy` が見つかった場合のみクリップボードへ転送する。
  - 対応コマンドが存在しない環境ではエラー終了。
- `stdout` への出力は既定で常に行い、`--no-stdout` は今回導入しない。
- 旧フラグ（例: `--d2-file`, `--mermaid-file`）は完全削除し、ヘルプにも記載しない。

### モード別の扱い
- **ask**
  - 取得した本文を `stdout`、`--output` 指定先、`--copy` へ同時に送る。
  - ツール構成は従来通り `READ_FILE_TOOL` のみ。
- **d2 / mermaid**
  - `--output` 未指定なら既定ファイル名（`diagram.d2` / `diagram.mmd`）を必ず用意し、そこへ書き出す。
  - `ensure*Context` は最終的なファイルパスを決定し、ディレクトリ指定などの異常を即エラーにする。
- **sql**
  - `--output` 未指定時も `query.sql`既定パスをワークスペース内に決め打ちし必ず書き出す。(つまり、d2 / mermaid と挙動が同じ)
  - `--output` 指定時は明示パスへ保存し、どちらの場合も同じ内容を `stdout` に流す。
  - サマリ専用の保存は行わない。

### 履歴連携
- 各タスクの履歴に `output: { file: string; copy?: boolean }` を追加し、ファイルパスは常に保存する。
- 継続実行（`-c` や `-r`）では、ユーザーが明示変更しない限り過去の設定を再適用する。
- 履歴表示（`-s` など）ではファイルパスとコピー有無を合わせて表示する。

### 実装ステップ
1. `CliOptions`・各 CLI `parseArgs` の Zod スキーマとヘルプを更新し、旧フラグを削除。
2. `outputTargets`（仮称）を処理する共通ヘルパーを作成し、`process.stdout.write` 直前で利用。
3. `HistoryStore` 周辺を拡張し、`output` 情報の保存・復元と表示を行う。
4. 新フラグ挙動のテスト（正常系・異常系・履歴引き継ぎ）を追加。
5. `README.md` などユーザー向けドキュメントの更新。
